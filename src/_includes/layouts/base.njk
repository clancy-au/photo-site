<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>{{ title or site.title or "Site" }}</title>
<link rel="stylesheet" href="/assets/css/styles.css">
</head><body class="dark">
	<header class="site-header">
		<h1><a class="brand" href="/">{{ site.title or "Clancy Malcolm Photography" }}</a></h1>
		<nav class="site-nav">
			{% for item in site.nav %}
			  <a href="{{ item.href }}">{{ item.label }}</a>{% if not loop.last %} <span aria-hidden="true" class="sep">|</span> {% endif %}
			{% endfor %}
		</nav>
	</header>
<main>{{ content | safe }}</main>

<!-- Lightbox Modal -->
<div id="lightbox" class="lightbox" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="lightbox-caption">
  <div class="lightbox-backdrop"></div>
  <div class="lightbox-content">
    <button class="lightbox-close" aria-label="Close lightbox">1&times;</button>
    <img class="lightbox-image" src="" alt="">
    <div class="lightbox-info">
      <div class="lightbox-caption" id="lightbox-caption"></div>
      <div class="lightbox-exif"></div>
    </div>
  </div>
</div>

<footer class="site-footer"><p>© {{ "now" | date("yyyy") }} {{ site.author or "Clancy Malcolm" }}</p></footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const lightbox = document.getElementById('lightbox');
  const lightboxImage = lightbox.querySelector('.lightbox-image');
  const lightboxCaption = lightbox.querySelector('.lightbox-caption');
  const lightboxExif = lightbox.querySelector('.lightbox-exif');
  const lightboxClose = lightbox.querySelector('.lightbox-close');
  const lightboxBackdrop = lightbox.querySelector('.lightbox-backdrop');
  
  // Ensure the lightbox is a direct child of <body> (iOS fixed-position quirk)
  if (lightbox.parentElement !== document.body) {
    document.body.appendChild(lightbox);
  }
  
  // Open lightbox
  document.addEventListener('click', function(e) {
    if (e.target.closest('.lightbox-trigger')) {
      e.preventDefault();
      const trigger = e.target.closest('.lightbox-trigger');
      
      const src = trigger.dataset.src;
      const caption = trigger.dataset.caption;
      const camera = trigger.dataset.camera;
      const lens = trigger.dataset.lens;
      const focalLength = trigger.dataset.focalLength;
      const aperture = trigger.dataset.aperture;
      const shutterSpeed = trigger.dataset.shutterSpeed;
      const iso = trigger.dataset.iso;
      const dateTime = trigger.dataset.dateTime;
      
      lightboxImage.src = src;
      lightboxImage.alt = caption;
      lightboxCaption.textContent = caption;
      
      // Build EXIF info
      const exifItems = [];
      if (camera) exifItems.push(camera);
      if (lens) exifItems.push(lens);
      if (focalLength) exifItems.push(focalLength);
      if (aperture) exifItems.push(aperture);
      if (shutterSpeed) exifItems.push(shutterSpeed);
      if (iso) exifItems.push(`ISO ${iso}`);
      
      let exifHTML = '';
      if (exifItems.length > 0) {
        exifHTML += '<div class="exif-data">' + exifItems.join(' • ') + '</div>';
      }
      if (dateTime) {
        exifHTML += '<div class="exif-date">' + dateTime + '</div>';
      }
      
      lightboxExif.innerHTML = exifHTML;

      lightbox.style.display = 'flex';

      // iOS-friendly scroll lock: fix body to current scroll position
      const scrollY = window.scrollY || document.documentElement.scrollTop || 0;
      document.body.dataset.scrollY = String(scrollY);
      document.body.style.position = 'fixed';
      document.body.style.top = `-${scrollY}px`;
      document.body.style.width = '100%';

      // Focus management
      lightboxClose.focus();
    }
  });
  
  // Close lightbox
  function closeLightbox() {
    lightbox.style.display = 'none';
    // Restore scroll lock
    const y = parseInt(document.body.dataset.scrollY || '0', 10);
    document.body.style.position = '';
    document.body.style.top = '';
    document.body.style.width = '';
    document.body.style.overflow = '';
    window.scrollTo(0, y);
  }
  
  lightboxClose.addEventListener('click', closeLightbox);
  lightboxBackdrop.addEventListener('click', closeLightbox);
  
  // Close on Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && lightbox.style.display === 'flex') {
      closeLightbox();
    }
  });
});
</script>

</body></html>
